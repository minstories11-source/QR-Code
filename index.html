<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>QR Generator Pro</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <h1>ğŸ“± QR Generator Pro</h1>
            <button id="theme-toggle" class="theme-btn">ğŸŒ™</button>
        </header>

        <!-- Tabs -->
        <nav class="tabs">
            <button class="tab active" data-tab="generate">Generate</button>
            <button class="tab" data-tab="database">Database</button>
            <button class="tab" data-tab="scan">Scan</button>
            <button class="tab" data-tab="settings">Settings</button>
        </nav>

        <!-- Generate Tab -->
        <div id="generate-tab" class="tab-content active">
            <div class="card">
                <h2>Create QR Code</h2>
                <div class="form-group">
                    <label for="qr-input">Text or URL</label>
                    <textarea id="qr-input" rows="3" placeholder="Enter text, URL, or data..."></textarea>
                    <small><span id="char-count">0</span> / 2953 characters</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="error-level">Error Correction</label>
                        <select id="error-level">
                            <option value="L">Low (7%)</option>
                            <option value="M" selected>Medium (15%)</option>
                            <option value="Q">Quartile (25%)</option>
                            <option value="H">High (30%)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fg-color">Color</label>
                        <input type="color" id="fg-color" value="#000000">
                    </div>
                </div>

                <button id="generate-btn" class="btn btn-primary">Generate QR Code</button>
            </div>

            <div id="qr-result" class="card hidden">
                <div id="qr-display" class="qr-display"></div>
                <p id="qr-data-preview" class="text-muted text-center"></p>
                <div class="btn-group">
                    <button id="download-png" class="btn btn-secondary">ğŸ’¾ Save</button>
                    <button id="copy-qr" class="btn btn-secondary">ğŸ“‹ Copy</button>
                    <button id="print-qr" class="btn btn-secondary">ğŸ–¨ï¸ Print</button>
                </div>
            </div>

            <div class="card">
                <h3>Recent</h3>
                <div id="history-list"></div>
                <button id="clear-history" class="btn btn-small btn-secondary">Clear History</button>
            </div>
        </div>

        <!-- Database Tab -->
        <div id="database-tab" class="tab-content">
            <div id="no-db-message" class="card">
                <p class="text-muted text-center">No database loaded</p>
                <button id="go-to-settings" class="btn btn-primary">Load Database</button>
            </div>

            <div id="db-search-section" class="card" style="display: none;">
                <div id="db-info-text" class="text-muted" style="margin-bottom: 1rem;"></div>
                <div class="search-wrapper">
                    <input type="text" id="db-search" placeholder="Search by label or ID...">
                    <button id="clear-search" class="clear-btn" style="display: none;">âœ•</button>
                </div>
                <div id="search-results"></div>
            </div>

            <div id="db-qr-result" class="card" style="display: none;">
                <div id="db-qr-display" class="qr-display"></div>
                <h3 id="db-qr-label" class="text-center"></h3>
                <p id="db-qr-id" class="text-muted text-center"></p>
                <div class="btn-group">
                    <button id="db-download-png" class="btn btn-secondary">ğŸ’¾ Save</button>
                    <button id="db-copy-qr" class="btn btn-secondary">ğŸ“‹ Copy</button>
                    <button id="db-print-qr" class="btn btn-secondary">ğŸ–¨ï¸ Print</button>
                </div>
            </div>
        </div>

        <!-- Scan Tab -->
        <div id="scan-tab" class="tab-content">
            <div class="card">
                <div class="scanner-container">
                    <video id="scanner-video" playsinline></video>
                    <div class="scanner-overlay"></div>
                </div>
                <p id="scanner-status" class="text-center text-muted">Tap to start camera</p>
                <button id="start-scanner-btn" class="btn btn-primary" style="width: 100%;">ğŸ“· Start Camera</button>
                
                <div class="form-row" style="margin-top: 1rem;">
                    <select id="camera-select" class="form-control">
                        <option value="">Select camera...</option>
                    </select>
                    <label class="btn btn-secondary" style="margin: 0;">
                        ğŸ“ Upload
                        <input type="file" id="scan-upload" accept="image/*" hidden>
                    </label>
                </div>
            </div>

            <!-- Chain Receive UI (hidden by default) -->
            <div id="chain-receive-ui" class="card" style="display: none; background: linear-gradient(135deg, var(--primary-light), var(--bg-secondary));">
                <h3>ğŸ“¥ Receiving Database Transfer...</h3>
                
                <div style="text-align: center; margin: 1.5rem 0;">
                    <div style="font-size: 2rem; font-weight: bold; color: var(--primary);">
                        <span id="chain-receive-progress">0 of 0</span>
                    </div>
                    <div style="margin-top: 1rem; background: rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden; height: 16px;">
                        <div id="chain-receive-bar" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary), var(--success)); transition: width 0.3s;"></div>
                    </div>
                    <p id="chain-receive-missing" class="text-muted" style="margin-top: 1rem;">Keep scanning QR codes...</p>
                </div>
                
                <button id="cancel-chain-receive" class="btn btn-secondary" style="width: 100%;">
                    âœ• Cancel Transfer
                </button>
            </div>

            <div id="scan-result" class="card" style="display: none;">
                <h3>Scanned Result</h3>
                <pre id="scan-data" class="scan-data"></pre>
                <div class="btn-group">
                    <button id="copy-scan" class="btn btn-secondary">ğŸ“‹ Copy</button>
                    <button id="open-url" class="btn btn-secondary">ğŸ”— Open</button>
                    <button id="generate-from-scan" class="btn btn-secondary">ğŸ“² To QR</button>
                </div>
            </div>

            <div class="card">
                <h3>Scan History</h3>
                <div id="scan-history"></div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <!-- Phone-to-Phone Transfer -->
            <div class="card">
                <h3>ğŸ“² Phone-to-Phone Transfer</h3>
                <p class="text-muted">Transfer your database to another phone via QR codes - no internet needed!</p>
                
                <button id="start-chain-transfer" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                    ğŸ“¤ Transfer Active Database
                </button>
                
                <!-- Sender UI (hidden by default) -->
                <div id="chain-transfer-ui" style="display: none; margin-top: 1.5rem;">
                    <div id="chain-qr-display" class="qr-display" style="margin: 0 auto;"></div>
                    
                    <div style="text-align: center; margin: 1rem 0;">
                        <div style="font-size: 1.25rem; font-weight: bold;">
                            Showing QR <span id="chain-progress">1 of 1</span>
                        </div>
                        <div style="margin-top: 0.75rem; background: var(--bg-secondary); border-radius: 8px; overflow: hidden; height: 10px;">
                            <div id="chain-progress-bar" style="width: 0%; height: 100%; background: var(--primary); transition: width 0.3s;"></div>
                        </div>
                        <p class="text-muted" style="margin-top: 0.5rem; font-size: 0.875rem;">
                            Point receiving phone's camera at these codes
                        </p>
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; justify-content: center;">
                        <button id="chain-prev" class="btn btn-secondary">â—€ Prev</button>
                        <button id="chain-next" class="btn btn-secondary">Next â–¶</button>
                    </div>
                    
                    <div style="margin-top: 1.25rem;">
                        <label style="display: flex; justify-content: space-between;">
                            <span>Auto-cycle Speed</span>
                            <span id="chain-speed-label">2.0s</span>
                        </label>
                        <input type="range" id="chain-speed" min="500" max="5000" step="250" value="2000" style="width: 100%; margin-top: 0.5rem;">
                    </div>
                    
                    <button id="stop-chain-transfer" class="btn btn-danger" style="width: 100%; margin-top: 1.25rem;">
                        âœ• Stop Transfer
                    </button>
                </div>
            </div>

            <!-- Import Database -->
            <div class="card">
                <h3>ğŸ“‚ Import Database</h3>
                <div id="db-drop-zone" class="drop-zone">
                    <p>ğŸ“ Tap to select file or drag & drop</p>
                    <p class="text-muted">JSON or CSV</p>
                    <input type="file" id="db-upload" accept=".json,.csv,.tsv,.txt" hidden>
                </div>
                
                <div class="divider">or load from URL</div>
                
                <div class="form-row">
                    <input type="url" id="db-url" placeholder="https://example.com/data.json" class="form-control">
                    <button id="load-db-url" class="btn btn-secondary">Load</button>
                </div>
                
                <div id="upload-status" class="status" style="display: none;"></div>
            </div>

            <!-- Active Database -->
            <div id="active-db-card" class="card" style="display: none;">
                <h3>âœ“ Active Database</h3>
                <p id="active-db-name" style="font-weight: bold;"></p>
                <p id="active-db-info" class="text-muted"></p>
                <div class="btn-group">
                    <button id="export-db" class="btn btn-secondary">ğŸ“¤ Export JSON</button>
                    <button id="export-csv" class="btn btn-secondary">ğŸ“¤ Export CSV</button>
                </div>
            </div>

            <!-- All Databases -->
            <div class="card">
                <h3>ğŸ“š Your Databases</h3>
                <div id="db-list"></div>
            </div>

            <!-- Storage Info -->
            <div class="card">
                <h3>ğŸ’¾ Storage</h3>
                <div id="storage-info" class="text-muted"></div>
                <button id="clear-all-data" class="btn btn-danger" style="margin-top: 1rem;">ğŸ—‘ï¸ Clear All Data</button>
            </div>
        </div>

        <!-- Toast -->
        <div id="toast" class="toast"></div>
    </div>

    <script src="app.js"></script>
</body>
</html>
