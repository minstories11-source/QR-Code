<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="description" content="Free QR Code Generator with Database Support">
    <title>QR Generator Pro</title>
    
    <link rel="stylesheet" href="styles.css">
    
    <!-- Libraries from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
</head>
<body>
    
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1>âš¡ QR Generator Pro</h1>
            <button id="theme-toggle" class="btn-icon" title="Toggle theme">ğŸŒ™</button>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-tabs">
        <button class="tab active" data-tab="generate">Generate</button>
        <button class="tab" data-tab="database">Database</button>
        <button class="tab" data-tab="scan">Scan</button>
        <button class="tab" data-tab="settings">Settings</button>
    </nav>

    <!-- Main Content -->
    <main class="main">

        <!-- ========== GENERATE TAB ========== -->
        <section id="generate-tab" class="tab-content active">
            <div class="card">
                <h2>Create QR Code</h2>
                
                <div class="form-group">
                    <label for="qr-input">Text or URL</label>
                    <textarea id="qr-input" rows="3" placeholder="Enter text or URL..."></textarea>
                    <small class="char-counter"><span id="char-count">0</span> / 2953</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="error-level">Error Correction</label>
                        <select id="error-level">
                            <option value="L">Low (7%)</option>
                            <option value="M" selected>Medium (15%)</option>
                            <option value="Q">High (25%)</option>
                            <option value="H">Maximum (30%)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fg-color">Color</label>
                        <input type="color" id="fg-color" value="#000000">
                    </div>
                </div>

                <input type="color" id="bg-color" value="#ffffff" class="hidden">

                <button id="generate-btn" class="btn btn-primary btn-block">Generate QR Code</button>
            </div>

            <!-- QR Result -->
            <div id="qr-result" class="card hidden">
                <div id="qr-display" class="qr-display"></div>
                <p id="qr-data-preview" class="text-muted text-center"></p>
                <div class="btn-group">
                    <button id="download-png" class="btn btn-primary">ğŸ“¥ Download</button>
                    <button id="copy-qr" class="btn btn-secondary">ğŸ“‹ Copy</button>
                    <button id="print-qr" class="btn btn-secondary">ğŸ–¨ï¸ Print</button>
                </div>
            </div>

            <!-- History -->
            <div class="card">
                <h2>Recent History</h2>
                <div id="history-list" class="history-list">
                    <p class="text-muted">No history yet</p>
                </div>
                <button id="clear-history" class="btn btn-small btn-danger">Clear History</button>
            </div>
        </section>

        <!-- ========== DATABASE TAB ========== -->
        <section id="database-tab" class="tab-content">
            
            <!-- No database message -->
            <div id="no-db-message" class="card text-center">
                <div class="empty-state">
                    <div class="empty-icon">ğŸ“¦</div>
                    <h2>No Database Loaded</h2>
                    <p class="text-muted">Go to Settings to upload a CSV file</p>
                    <button id="go-to-settings" class="btn btn-primary">Go to Settings</button>
                </div>
            </div>

            <!-- Database search section -->
            <div id="db-search-section" class="hidden">
                <div class="card">
                    <h2>ğŸ” Search Database</h2>
                    <p id="db-info-text" class="text-muted"></p>
                    
                    <div class="form-group search-wrapper">
                        <input type="text" id="db-search" placeholder="Type to search..." autocomplete="off">
                        <button id="clear-search" class="clear-btn hidden">âœ•</button>
                    </div>

                    <!-- Search Results -->
                    <div id="search-results" class="search-results-list"></div>
                </div>

                <!-- Add Entry Button -->
                <button id="show-add-entry" class="btn btn-secondary btn-block">
                    â• Add New Entry
                </button>

                <!-- Add Entry Form (hidden by default) -->
                <div id="add-entry-form" class="card hidden">
                    <h2>â• Add New Entry</h2>
                    <div id="entry-fields"></div>
                    <div class="btn-group" style="margin-top: 16px;">
                        <button id="save-entry" class="btn btn-primary">ğŸ’¾ Save</button>
                        <button id="cancel-add-entry" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>

                <!-- QR Code Result -->
                <div id="db-qr-result" class="card hidden">
                    <div id="db-qr-display" class="qr-display"></div>
                    <p id="db-qr-label" class="qr-label"></p>
                    <p id="db-qr-id" class="text-muted text-center"></p>
                    <div class="btn-group">
                        <button id="db-download-png" class="btn btn-primary">ğŸ“¥ Download</button>
                        <button id="db-copy-qr" class="btn btn-secondary">ğŸ“‹ Copy</button>
                        <button id="db-print-qr" class="btn btn-secondary">ğŸ–¨ï¸ Print</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ========== SCAN TAB ========== -->
        <section id="scan-tab" class="tab-content">
            <div class="card">
                <h2>ğŸ“· Scan QR Code</h2>
                
                <!-- Scanner Status -->
                <p id="scanner-status" class="text-muted text-center"></p>
                
                <!-- Start Button (for iOS) -->
                <button id="start-scanner-btn" class="btn btn-primary btn-block" style="margin-bottom: 16px;">
                    ğŸ“· Start Camera
                </button>
                
                <!-- Video Container -->
                <div class="scanner-container">
                    <video id="scanner-video" autoplay playsinline muted></video>
                    <div class="scanner-overlay">
                        <div class="scanner-frame"></div>
                        <div class="scanner-hint">Align QR code within frame</div>
                    </div>
                </div>

                <!-- Camera Selector -->
                <div class="form-group">
                    <label for="camera-select">Camera</label>
                    <select id="camera-select">
                        <option>Select camera...</option>
                    </select>
                </div>

                <div class="divider"><span>OR</span></div>

                <!-- Upload Image -->
                <div class="form-group">
                    <label for="scan-upload" class="btn btn-secondary btn-block">
                        ğŸ“ Upload QR Image
                    </label>
                    <input type="file" id="scan-upload" accept="image/*" class="hidden">
                </div>
            </div>

            <!-- Chain Receive UI (hidden by default) -->
            <div id="chain-receive-ui" class="card hidden">
                <h2>ğŸ“¥ Receiving Transfer...</h2>
                
                <div class="chain-receive-status">
                    <div class="chain-receive-count">
                        <span id="chain-receive-progress">0 of 0</span>
                    </div>
                    <div class="progress-bar-container">
                        <div id="chain-receive-bar" class="progress-bar-fill"></div>
                    </div>
                    <p id="chain-receive-missing" class="text-muted">Keep scanning QR codes...</p>
                </div>
                
                <button id="cancel-chain-receive" class="btn btn-secondary btn-block">
                    âœ• Cancel Transfer
                </button>
            </div>

            <!-- Scan Result -->
            <div id="scan-result" class="card hidden">
                <h2>âœ… Scan Result</h2>
                <div id="scan-data" class="scan-data"></div>
                <div class="btn-group">
                    <button id="copy-scan" class="btn btn-primary">ğŸ“‹ Copy</button>
                    <button id="open-url" class="btn btn-secondary">ğŸ”— Open URL</button>
                    <button id="generate-from-scan" class="btn btn-secondary">âš¡ Make QR</button>
                </div>
            </div>

            <!-- Scan History -->
            <div class="card">
                <h2>Scan History</h2>
                <div id="scan-history" class="history-list">
                    <p class="text-muted">No scans yet</p>
                </div>
            </div>
        </section>

        <!-- ========== SETTINGS TAB ========== -->
        <section id="settings-tab" class="tab-content">
            
            <!-- Phone-to-Phone Transfer -->
            <div class="card">
                <h2>ğŸ“² Phone-to-Phone Transfer</h2>
                <p class="text-muted">Transfer database to another phone via QR codes - no internet needed!</p>
                
                <div class="form-group" style="margin-top: 12px;">
                    <label for="chunk-size-select">Transfer Mode</label>
                    <select id="chunk-size-select">
                        <option value="400">ğŸ¢ Extra Safe (most codes, easiest)</option>
                        <option value="600" selected>ğŸ“¶ Reliable (recommended)</option>
                        <option value="800">âš–ï¸ Balanced</option>
                        <option value="1200">ğŸš€ Fast (fewer codes)</option>
                        <option value="2000">âš¡ Turbo (experimental)</option>
                    </select>
                </div>
                
                <button id="start-chain-transfer" class="btn btn-primary btn-block" style="margin-top: 12px;">
                    ğŸ“¤ Transfer Active Database
                </button>
                
                <!-- Sender UI (hidden by default) -->
                <div id="chain-transfer-ui" class="hidden" style="margin-top: 16px;">
                    <div id="chain-qr-display" class="qr-display"></div>
                    
                    <div class="chain-progress-info">
                        <p class="chain-progress-text">
                            Showing QR <strong><span id="chain-progress">1 of 1</span></strong>
                        </p>
                        <div class="progress-bar-container">
                            <div id="chain-progress-bar" class="progress-bar-fill"></div>
                        </div>
                        <p class="text-muted help-text">Point receiving phone's camera at these codes</p>
                    </div>
                    
                    <div class="btn-group">
                        <button id="chain-prev" class="btn btn-secondary">â—€ Prev</button>
                        <button id="chain-pause" class="btn btn-secondary">â¸ï¸ Pause</button>
                        <button id="chain-next" class="btn btn-secondary">Next â–¶</button>
                    </div>
                    
                    <div class="form-group" style="margin-top: 16px;">
                        <label class="speed-label">
                            <span>Auto-cycle Speed</span>
                            <span id="chain-speed-label">2.0s</span>
                        </label>
                        <input type="range" id="chain-speed" min="500" max="5000" step="250" value="2000">
                    </div>
                    
                    <button id="stop-chain-transfer" class="btn btn-danger btn-block" style="margin-top: 12px;">
                        âœ• Stop Transfer
                    </button>
                </div>
            </div>

            <!-- Upload Database -->
            <div class="card">
                <h2>ğŸ“¦ Import Database</h2>
                
                <div class="upload-zone" id="db-drop-zone">
                    <div class="upload-icon">ğŸ“‚</div>
                    <p>Tap to upload file</p>
                    <small class="help-text">Supports: CSV, TSV, JSON</small>
                    <input type="file" id="db-upload" accept=".csv,.tsv,.txt,.json">
                </div>

                <div id="upload-status" class="status hidden"></div>
            </div>

            <!-- Load from URL -->
            <div class="card">
                <h2>ğŸŒ Load from URL</h2>
                <div class="form-group">
                    <input type="text" id="db-url" placeholder="https://example.com/database.json">
                    <button id="load-db-url" class="btn btn-secondary btn-block" style="margin-top: 8px;">Load Database</button>
                </div>
            </div>

            <!-- Your Databases -->
            <div class="card">
                <h2>ğŸ“‹ Your Databases</h2>
                <div id="db-list" class="db-list">
                    <p class="text-muted">No databases loaded</p>
                </div>
            </div>

            <!-- Merge Databases -->
            <div class="card">
                <h2>ğŸ”€ Merge Databases</h2>
                <p class="text-muted">Combine another database into the active one (unique IDs only)</p>
                <button id="show-merge-modal" class="btn btn-secondary btn-block" style="margin-top: 12px;">
                    Merge Into Active Database
                </button>
            </div>

            <!-- Active Database Actions -->
            <div id="active-db-card" class="card hidden">
                <h2>âœ“ Active Database</h2>
                <p><strong id="active-db-name"></strong></p>
                <p id="active-db-info" class="text-muted"></p>
                
                <div class="btn-group" style="margin-top: 12px;">
                    <button id="export-db" class="btn btn-secondary">ğŸ“¤ Export JSON</button>
                    <button id="export-csv" class="btn btn-secondary">ğŸ“„ Export CSV</button>
                </div>
            </div>

            <!-- Storage Info -->
            <div class="card">
                <h2>ğŸ’¾ Storage</h2>
                <p id="storage-info" class="text-muted">Calculating...</p>
                <button id="clear-all-data" class="btn btn-small btn-danger" style="margin-top: 12px;">Clear All Data</button>
            </div>

        </section>

    </main>

    <!-- Merge Modal -->
    <div id="merge-modal" class="modal hidden">
        <div class="modal-content card">
            <h2>ğŸ”€ Merge Databases</h2>
            <p class="text-muted">Select a database to merge into the active one. Entries with duplicate IDs will be skipped.</p>
            
            <div class="form-group" style="margin-top: 16px;">
                <label for="merge-source">Merge from:</label>
                <select id="merge-source"></select>
            </div>
            
            <div class="btn-group" style="margin-top: 16px;">
                <button id="confirm-merge" class="btn btn-primary">ğŸ”€ Merge</button>
                <button id="cancel-merge" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>QR Generator Pro by jureczk</p>
    </footer>

    <!-- Toast -->
    <div id="toast" class="toast hidden"></div>

    <script src="app.js"></script>
</body>
</html>
